<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Acesso - RoboSorteio IA</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: #000; padding: 20px; }
        .login-box { width: 100%; max-width: 400px; }
        
        /* Banner de Lucro com visibilidade for√ßada */
        .banner-lucro-fix { 
            background: #00ff88 !important; 
            color: #000 !important; 
            font-size: 0.85rem; 
            padding: 12px; 
            text-align: center; 
            font-weight: bold; 
            border-radius: 8px; 
            margin-bottom: 20px; 
            display: block !important;
            font-family: 'Orbitron', sans-serif;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { 
            flex: 1; padding: 12px; background: #111; border: 1px solid #333; 
            color: #555; font-size: 0.75rem; font-family: 'Orbitron'; cursor: pointer; 
        }
        .tab-btn.active { border-color: #00f2ff; color: #00f2ff; background: rgba(0,242,255,0.05); }

        /* Rodap√© Legislativo */
        .footer-legal { 
            font-size: 0.65rem; color: #555; text-align: justify; 
            margin-top: 25px; line-height: 1.3; border-top: 1px solid #222; padding-top: 15px; 
            font-family: 'Rajdhani', sans-serif;
        }
        .footer-legal b { color: #888; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="login-box">
        <div style="text-align: center; margin-bottom: 20px;">
            <h1 style="font-family: 'Orbitron'; color: #00f2ff; font-size: 1.6rem; letter-spacing: 2px;">ROBOSORTEIO IA</h1>
        </div>

        <div class="banner-lucro-fix">
            üöÄ GANHE AT√â <b>R$ 450,00/M√äS</b> COM TAREFAS
        </div>

        <div class="tab-container">
            <button onclick="window.toggleTab('login')" id="tab-l" class="tab-btn active">ENTRAR</button>
            <button onclick="window.toggleTab('cad')" id="tab-c" class="tab-btn">CADASTRAR</button>
        </div>

        <div id="form-login">
            <div class="card">
                <input type="email" id="l-email" placeholder="E-mail">
                <input type="password" id="l-senha" placeholder="Senha">
                <button onclick="window.handleLogin()" class="btn-primary" style="margin-top: 10px;">ACESSAR PAINEL</button>
            </div>
        </div>

        <div id="form-cad" class="hidden">
            <div class="card">
                <input type="text" id="c-nome" placeholder="Nome Completo">
                <input type="email" id="c-email" placeholder="Seu E-mail">
                <input type="password" id="c-senha" placeholder="Crie uma Senha">
                <input type="text" id="c-ref" placeholder="C√≥digo de Convite (Opcional)">
                <button onclick="window.handleCadastrar()" class="btn-outline" style="margin-top: 10px; border-color: #00ff88; color: #00ff88;">CRIAR CONTA GRATUITA</button>
            </div>
        </div>

        <div class="footer-legal">
            <b>TERMOS E CONFORMIDADE:</b> Este sistema opera como uma plataforma de recompensas por tarefas e entretenimento digital. 
            Em conformidade com a <b>LGPD (Lei 13.709/2018)</b>, todos os dados de utilizador est√£o criptografados e protegidos. 
            Os ganhos citados s√£o proje√ß√µes baseadas no cumprimento integral de tarefas di√°rias e metas de indica√ß√£o. 
            Este site n√£o constitui promessa de rendimento fixo ou investimento financeiro. Proibido para menores de 18 anos. 
            Ao continuar, declara aceitar os nossos <b>Termos de Uso</b> e <b>Pol√≠ticas de Privacidade</b>.
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, updateDoc, increment, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYO5RWaJy5y7r7jvzFk3wq-ByqM_dWWO8",
            authDomain: "minharifadigital.firebaseapp.com",
            projectId: "minharifadigital",
            storageBucket: "minharifadigital.firebasestorage.app",
            messagingSenderId: "59630725905",
            appId: "1:59630725905:web:396c8cfca385dc3d957ab0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- EXPOSI√á√ÉO DAS FUN√á√ïES PARA O HTML ---
        window.toggleTab = (type) => {
            const isCad = type === 'cad';
            document.getElementById('form-login').classList.toggle('hidden', isCad);
            document.getElementById('form-cad').classList.toggle('hidden', !isCad);
            document.getElementById('tab-l').classList.toggle('active', !isCad);
            document.getElementById('tab-c').classList.toggle('active', isCad);
        };

        window.handleLogin = async () => {
            const e = document.getElementById('l-email').value;
            const s = document.getElementById('l-senha').value;
            if(!e || !s) return alert("Preencha todos os campos!");
            try {
                await signInWithEmailAndPassword(auth, e, s);
            } catch (err) { alert("Dados incorretos ou utilizador n√£o encontrado."); }
        };

        window.handleCadastrar = async () => {
            const n = document.getElementById('c-nome').value;
            const e = document.getElementById('c-email').value;
            const s = document.getElementById('c-senha').value;
            const r = document.getElementById('c-ref').value;

            if(!n || !e || !s) return alert("Preencha Nome, E-mail e Senha!");

            try {
                const res = await createUserWithEmailAndPassword(auth, e, s);
                const code = Math.random().toString(36).substring(2, 7).toUpperCase();
                
                await setDoc(doc(db, "usuarios", res.user.uid), {
                    nome: n, email: e, meuCodigo: code, saldo: 0, vendas: 0, xp: 0
                });
                
                if (r) {
                    const q = query(collection(db, "usuarios"), where("meuCodigo", "==", r));
                    const snap = await getDocs(q);
                    if (!snap.empty) {
                        await updateDoc(doc(db, "usuarios", snap.docs[0].id), { 
                            saldo: increment(0.10), 
                            vendas: increment(1) 
                        });
                    }
                }
            } catch (err) { alert("Erro ao cadastrar: " + err.message); }
        };

        // Redirecionamento se j√° logado
        onAuthStateChanged(auth, (u) => { if(u) window.location.href = 'index.html'; });
    </script>
</body>
</html>
