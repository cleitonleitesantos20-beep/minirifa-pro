<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Acesso - RoboSorteio IA</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: #000; padding: 20px; }
        .login-box { width: 100%; max-width: 400px; }
        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; background: #111; border: 1px solid #333; color: #555; font-size: 0.75rem; font-family: 'Orbitron'; cursor: pointer; }
        .tab-btn.active { border-color: var(--neon); color: var(--neon); background: rgba(0,242,255,0.05); }
        .banner-lucro-fix { background: var(--green); color: #000; font-size: 0.8rem; padding: 10px; text-align: center; font-weight: bold; border-radius: 8px; margin-bottom: 20px; display: block !important; visibility: visible !important; opacity: 1 !important; }
        .footer-legal { font-size: 0.6rem; color: #444; text-align: justify; margin-top: 25px; line-height: 1.2; border-top: 1px solid #222; padding-top: 15px; }
        .footer-legal b { color: #666; }
    </style>
</head>
<body>

    <div class="login-box">
        <div style="text-align: center; margin-bottom: 20px;">
            <h1 style="font-family: 'Orbitron'; color: var(--neon); font-size: 1.5rem; letter-spacing: 2px;">ROBOSORTEIO IA</h1>
        </div>

        <div class="banner-lucro-fix">
            üöÄ GANHE AT√â <b>R$ 450,00/M√äS</b>
        </div>

        <div class="tab-container">
            <button onclick="toggleTab('login')" id="tab-l" class="tab-btn active">ENTRAR</button>
            <button onclick="toggleTab('cad')" id="tab-c" class="tab-btn">CADASTRAR</button>
        </div>

        <div id="form-login">
            <div class="card">
                <input type="email" id="l-email" placeholder="Seu e-mail cadastrado">
                <input type="password" id="l-senha" placeholder="Sua senha">
                <button onclick="handleLogin()" class="btn-primary" id="btn-entrar">ACESSAR MINHA CONTA</button>
            </div>
        </div>

        <div id="form-cad" class="hidden">
            <div class="card">
                <input type="text" id="c-nome" placeholder="Nome Completo">
                <input type="email" id="c-email" placeholder="E-mail principal">
                <input type="password" id="c-senha" placeholder="Criar Senha (min. 6 d√≠gitos)">
                <input type="text" id="c-ref" placeholder="C√≥digo de Convite (Opcional)">
                <button onclick="handleCadastrar()" class="btn-outline" id="btn-cad">CRIAR CONTA GRATUITA</button>
            </div>
        </div>

        <div class="footer-legal">
            <b>TERMOS E CONFORMIDADE:</b> Este sistema opera como uma plataforma de recompensas por tarefas e entretenimento digital. 
            Em conformidade com a <b>LGPD (Lei 13.709/2018)</b>, seus dados est√£o criptografados. 
            Os ganhos citados s√£o proje√ß√µes baseadas no cumprimento integral de tarefas di√°rias e metas de indica√ß√£o. 
            Este site n√£o √© uma institui√ß√£o financeira. Proibido para menores de 18 anos. 
            Ao continuar, voc√™ aceita nossos termos de uso e pol√≠ticas de cookies.
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, updateDoc, increment, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYO5RWaJy5y7r7jvzFk3wq-ByqM_dWWO8",
            authDomain: "minharifadigital.firebaseapp.com",
            projectId: "minharifadigital",
            storageBucket: "minharifadigital.firebasestorage.app",
            messagingSenderId: "59630725905",
            appId: "1:59630725905:web:396c8cfca385dc3d957ab0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Redireciona se j√° estiver logado
        onAuthStateChanged(auth, (u) => { if(u) window.location.href = 'index.html'; });

        window.toggleTab = (type) => {
            document.getElementById('form-login').classList.toggle('hidden', type === 'cad');
            document.getElementById('form-cad').classList.toggle('hidden', type === 'login');
            document.getElementById('tab-l').classList.toggle('active', type === 'login');
            document.getElementById('tab-c').classList.toggle('active', type === 'cad');
        };

        // LOGIN CORRIGIDO (Adicionado bind window)
        window.handleLogin = async () => {
            const e = document.getElementById('l-email').value;
            const s = document.getElementById('l-senha').value;
            if(!e || !s) return alert("Preencha e-mail e senha!");
            
            try {
                await signInWithEmailAndPassword(auth, e, s);
            } catch (err) {
                alert("Falha no acesso: Verifique seus dados.");
            }
        };

        // CADASTRO CORRIGIDO (Adicionado bind window)
        window.handleCadastrar = async () => {
            const n = document.getElementById('c-nome').value;
            const e = document.getElementById('c-email').value;
            const s = document.getElementById('c-senha').value;
            const r = document.getElementById('c-ref').value;

            if(!n || !e || !s) return alert("Preencha todos os campos obrigat√≥rios!");

            try {
                const res = await createUserWithEmailAndPassword(auth, e, s);
                const code = Math.random().toString(36).substring(2, 7).toUpperCase();
                
                await setDoc(doc(db, "usuarios", res.user.uid), {
                    nome: n, email: e, meuCodigo: code, saldo: 0, vendas: 0, xp: 0, 
                    dataCriacao: new Date().toISOString()
                });
                
                if (r) {
                    const q = query(collection(db, "usuarios"), where("meuCodigo", "==", r));
                    const snap = await getDocs(q);
                    if (!snap.empty) {
                        await updateDoc(doc(db, "usuarios", snap.docs[0].id), { 
                            saldo: increment(0.10), 
                            vendas: increment(1) 
                        });
                    }
                }
            } catch (err) {
                alert("Erro ao criar conta: " + err.message);
            }
        };
    </script>
</body>
</html>
