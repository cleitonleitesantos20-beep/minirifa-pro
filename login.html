<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Acesso - Nexus System</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --green: #00ff88; --bg: #000; --card: #111; }
        * { box-sizing: border-box; }
        body { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--bg); padding: 20px; font-family: 'Rajdhani', sans-serif; color: #fff; margin: 0; }
        
        .login-box { width: 100%; max-width: 400px; }

        .banner-informativo { 
            background: rgba(0, 255, 136, 0.1); border: 1px solid var(--green); color: var(--green);
            font-size: 0.75rem; padding: 12px; text-align: center; border-radius: 8px; margin-bottom: 20px;
            font-family: 'Orbitron'; line-height: 1.4;
        }

        .tab-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { 
            flex: 1; padding: 12px; background: #080808; border: 1px solid #333; 
            color: #555; font-size: 0.7rem; font-family: 'Orbitron'; cursor: pointer; transition: 0.3s;
        }
        .tab-btn.active { border-color: var(--neon); color: var(--neon); background: rgba(0,242,255,0.05); }

        .card { background: var(--card); border: 1px solid #222; padding: 20px; border-radius: 12px; }
        input { 
            width: 100%; padding: 12px; margin-bottom: 12px; background: #000; border: 1px solid #333;
            color: #fff; border-radius: 6px; font-family: 'Rajdhani'; font-size: 1rem;
        }
        input:focus { border-color: var(--neon); outline: none; }

        .btn-action {
            width: 100%; padding: 14px; border: none; border-radius: 6px; font-family: 'Orbitron';
            font-size: 0.8rem; cursor: pointer; text-transform: uppercase; transition: 0.3s;
        }
        .btn-primary { background: var(--neon); color: #000; font-weight: bold; }
        .btn-secondary { background: transparent; border: 1px solid var(--green); color: var(--green); }

        .footer-legal { 
            font-size: 0.6rem; color: #444; text-align: justify; margin-top: 25px;
            line-height: 1.4; border-top: 1px solid #222; padding-top: 15px; text-transform: uppercase;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="login-box">
        <div style="text-align: center; margin-bottom: 25px;">
            <h1 style="font-family: 'Orbitron'; color: var(--neon); font-size: 1.4rem; letter-spacing: 3px; margin: 0;">NEXUS SYSTEM</h1>
            <p style="font-size: 0.7rem; color: #555; margin-top: 5px;">PLATAFORMA DE ENTRETENIMENTO E TAREFAS</p>
        </div>

        <div class="banner-informativo">
            RECOMPENSAS POR ATIVIDADE<br>
            <span style="font-size: 0.6rem; color: #aaa;">PROJE√á√ÉO BASEADA EM CUMPRIMENTO DE METAS</span>
        </div>

        <div class="tab-container">
            <button onclick="toggleTab('login')" id="tab-l" class="tab-btn active">LOGIN</button>
            <button onclick="toggleTab('cad')" id="tab-c" class="tab-btn">REGISTRO</button>
        </div>

        <div id="form-login">
            <div class="card">
                <input type="email" id="l-email" placeholder="E-mail de acesso">
                <input type="password" id="l-senha" placeholder="Sua senha">
                <button onclick="handleLogin()" class="btn-action btn-primary">Entrar no Painel</button>
            </div>
        </div>

        <div id="form-cad" class="hidden">
            <div class="card">
                <input type="text" id="c-nome" placeholder="Nome de usu√°rio">
                <input type="email" id="c-email" placeholder="E-mail v√°lido">
                <input type="password" id="c-senha" placeholder="Crie uma senha forte">
                <input type="text" id="c-ref" placeholder="C√≥digo de indica√ß√£o (opcional)">
                <button onclick="handleCadastrar()" class="btn-action btn-secondary">Criar Conta Gratuita</button>
            </div>
        </div>

        <div class="footer-legal">
            <b>Termos de Uso:</b> Este site n√£o garante renda fixa. As bonifica√ß√µes em NP (Nexus Points) dependem do desempenho em tarefas. 
            Em conformidade com a <b>LGPD</b>, seus dados est√£o protegidos. Uso restrito a maiores de 18 anos. 
            A participa√ß√£o em jogos e sorteios √© para fins de entretenimento digital.
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, updateDoc, increment, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYO5RWaJy5y7r7jvzFk3wq-ByqM_dWWO8",
            authDomain: "minharifadigital.firebaseapp.com",
            projectId: "minharifadigital",
            appId: "1:59630725905:web:396c8cfca385dc3d957ab0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        window.toggleTab = (type) => {
            const isCad = type === 'cad';
            document.getElementById('form-login').classList.toggle('hidden', isCad);
            document.getElementById('form-cad').classList.toggle('hidden', !isCad);
            document.getElementById('tab-l').classList.toggle('active', !isCad);
            document.getElementById('tab-c').classList.toggle('active', isCad);
        };

        window.handleLogin = async () => {
            const e = document.getElementById('l-email').value;
            const s = document.getElementById('l-senha').value;
            if(!e || !s) return alert("Preencha as credenciais.");
            try {
                await signInWithEmailAndPassword(auth, e, s);
            } catch (err) { alert("Acesso negado: verifique e-mail e senha."); }
        };

        window.handleCadastrar = async () => {
            const n = document.getElementById('c-nome').value;
            const e = document.getElementById('c-email').value;
            const s = document.getElementById('c-senha').value;
            const r = document.getElementById('c-ref').value;

            if(!n || !e || !s) return alert("Preencha todos os campos obrigat√≥rios.");

            try {
                const res = await createUserWithEmailAndPassword(auth, e, s);
                const code = Math.random().toString(36).substring(2, 7).toUpperCase();
                
                // CRIA√á√ÉO DO DOCUMENTO COM CAMPOS PARA O RANKING (Evita o "processando")
                await setDoc(doc(db, "usuarios", res.user.uid), {
                    nome: n,
                    email: e,
                    meuCodigo: code,
                    avatarEmoji: "üë§",
                    saldo: 0,
                    highScore: 0,       // Campo para o ranking de jogos
                    totalGasto: 0,      // Campo para o ranking de mercado
                    indicacoesCount: 0, // Campo para o ranking de indica√ß√µes
                    xp: 0,
                    dataCadastro: new Date().toISOString()
                });
                
                if (r) {
                    const q = query(collection(db, "usuarios"), where("meuCodigo", "==", r));
                    const snap = await getDocs(q);
                    if (!snap.empty) {
                        await updateDoc(doc(db, "usuarios", snap.docs[0].id), { 
                            saldo: increment(0.50), // B√¥nus por indica√ß√£o
                            indicacoesCount: increment(1) 
                        });
                    }
                }
                alert("Conta criada com sucesso!");
            } catch (err) { alert("Erro ao criar registro: " + err.message); }
        };

        onAuthStateChanged(auth, (u) => { if(u) window.location.href = 'index.html'; });
    </script>
</body>
</html>
