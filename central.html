<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Central IA v5.7.2 - Completa</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --pink: #ff0055; --green: #00ff88; --dark: #0a0a0a; }
        body { background: #000; color: #fff; font-family: 'Rajdhani'; margin: 0; padding: 0; min-height: 100vh; overflow-y: auto; }
        
        /* BARRA DE PROGRESSO FIXA NO TOPO */
        .top-progress-bar { position: sticky; top: 0; z-index: 100; background: #000; padding: 10px 15px; border-bottom: 1px solid #1a1a1a; }
        .lvl-section { background: var(--dark); padding: 10px; border-radius: 10px; border: 1px solid #222; }
        .progress-container { background: #111; height: 8px; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--neon), var(--green)); width: 0%; transition: 0.5s; }

        .header { height: 50px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; font-family: 'Orbitron'; font-size: 0.6rem; }
        .btn-exit { background: var(--pink); color: #fff; border: none; padding: 5px 12px; border-radius: 4px; font-family: 'Orbitron'; cursor: pointer; font-size: 0.5rem; }

        .container { padding: 10px 15px; padding-bottom: 40px; }
        
        /* ANÚNCIOS */
        .ad-banner { background: #0a0a0a; border: 1px dashed #333; color: #444; text-align: center; padding: 12px; font-family: 'Orbitron'; font-size: 0.45rem; margin: 10px 0; border-radius: 8px; }

        /* CHECK-IN */
        .daily-section { background: var(--dark); padding: 15px; border-radius: 15px; border: 1px solid #1a1a1a; margin-bottom: 15px; }
        .daily-grid { display: flex; justify-content: space-between; margin-top: 10px; }
        .day-dot { width: 28px; height: 28px; border-radius: 50%; border: 1px solid #222; display: flex; align-items: center; justify-content: center; font-size: 0.5rem; font-family: 'Orbitron'; color: #444; }
        .day-dot.active { border-color: var(--green); color: var(--green); }
        .day-dot.done { background: var(--green); color: #000; border: none; }
        .btn-checkin { width: 100%; margin-top: 12px; background: #111; border: 1px solid var(--green); color: var(--green); padding: 10px; border-radius: 8px; font-family: 'Orbitron'; font-size: 0.6rem; cursor: pointer; }

        /* OVERLAYS */
        #ad-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .game-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 20; display: flex; align-items: center; justify-content: center; border-radius: 12px; }

        /* GAMES */
        .game-card { background: var(--dark); border: 1px solid #1a1a1a; border-radius: 20px; padding: 15px; margin-bottom: 20px; position: relative; }
        .game-card h3 { font-family: 'Orbitron'; font-size: 0.65rem; margin: 0; color: var(--neon); }
        .game-stat { font-size: 0.5rem; color: #555; font-family: 'Orbitron'; margin-bottom: 5px; display: block; }
        .screen { background: #050505; border: 1px solid #111; border-radius: 12px; height: 130px; margin-top: 10px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        
        #cube-hero { width: 20px; height: 20px; background: var(--neon); position: absolute; bottom: 20px; left: 45px; box-shadow: 0 0 10px var(--neon); z-index: 10; }
        .obstacle { width: 14px; height: 28px; background: var(--pink); position: absolute; bottom: 20px; box-shadow: 0 0 8px var(--pink); }

        .btn-game { background: var(--neon); color: #000; border: none; padding: 10px 20px; font-family: 'Orbitron'; font-weight: bold; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="ad-overlay">
        <div style="font-family:'Orbitron'; color:var(--neon); margin-bottom:20px; font-size: 0.8rem;">SINCRONIZANDO RECOMPENSA...</div>
        <div id="ad-timer" style="font-family:'Orbitron'; font-size:3rem; color:var(--pink);">30</div>
    </div>

    <div class="top-progress-bar">
        <div class="lvl-section">
            <div style="display: flex; justify-content: space-between; font-family: 'Orbitron'; font-size: 0.5rem;">
                <span id="u-nome">...</span>
                <span style="color: var(--neon);">LVL <span id="u-lvl">1</span></span>
            </div>
            <div class="progress-container"><div class="progress-bar" id="xp-bar"></div></div>
            <div style="display:flex; justify-content:space-between; margin-top:4px; font-family:'Orbitron'; font-size:0.4rem; color: #666;">
                <span>XP: <span id="xp-num">0</span> / <span id="xp-target">1000</span></span>
                <span style="color:var(--green);">+R$ 0,10 / LVL</span>
            </div>
        </div>
    </div>

    <div class="header">
        <span>CENTRAL IA v5.7.2</span>
        <button class="btn-exit" onclick="window.location.href='index.html'">SAIR</button>
    </div>

    <div class="container">
        <div class="ad-banner">ANÚNCIO TOPO</div>

        <div class="daily-section">
            <div class="daily-grid" id="daily-dots">
                <div class="day-dot" data-day="1">S</div><div class="day-dot" data-day="2">T</div><div class="day-dot" data-day="3">Q</div>
                <div class="day-dot" data-day="4">Q</div><div class="day-dot" data-day="5">S</div><div class="day-dot" data-day="6">S</div>
                <div class="day-dot" data-day="0">D</div>
            </div>
            <button class="btn-checkin" id="btn-do-checkin" onclick="processCheckIn()">RESGATAR CHECK-IN (+R$ 0,02)</button>
        </div>

        <div class="game-card">
            <span class="game-stat">MELHOR TEMPO: <span id="best-runner" style="color:var(--green)">0</span>s</span>
            <h3>RUNNER CYBERPUNK (+1 XP)</h3>
            <div class="screen" id="runner-screen">
                <div id="runner-start-ui" class="game-overlay">
                    <button class="btn-game" onclick="startRunner()">INICIAR</button>
                </div>
                <div id="cube-hero" style="bottom: 20px;"></div>
                <div style="position:absolute; bottom:0; width:100%; height:20px; background:#111; border-top:1px solid #222;"></div>
            </div>
        </div>

        <div class="game-card">
            <span class="game-stat">MELHOR TEMPO: <span id="best-click" style="color:var(--green)">0</span>s</span>
            <h3>DATA CLICKER (+1 XP)</h3>
            <div class="screen">
                <div id="click-fill-bar" style="position:absolute; left:0; top:0; height:100%; width:0%; background: rgba(0,242,255,0.15); transition: 0.1s;"></div>
                <div id="click-txt" style="font-family:'Orbitron'; font-size:0.9rem; z-index:5; margin-bottom:10px;">META: 20 CLIQUES</div>
                <button class="btn-game" onclick="doClickGame()">CLICK!</button>
            </div>
        </div>

        <div class="game-card">
            <span class="game-stat">MELHOR SCORE: <span id="best-math" style="color:var(--green)">0</span></span>
            <h3>MATH IA (+1 XP)</h3>
            <div class="screen">
                <div id="math-quest" style="font-family:'Orbitron'; font-size:1.4rem; margin-bottom:10px;">0 + 0</div>
                <input type="number" id="math-ans" placeholder="?" style="background:#111; border:1px solid var(--neon); color:#fff; width:70px; text-align:center; padding:8px; font-family:'Orbitron';" oninput="checkMath(this)">
            </div>
        </div>

        <div class="ad-banner">ANÚNCIO RODAPÉ</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyAYO5RWaJy5y7r7jvzFk3wq-ByqM_dWWO8", authDomain: "minharifadigital.firebaseapp.com", projectId: "minharifadigital", appId: "1:59630725905:web:396c8cfca385dc3d957ab0" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let user, currentXP = 0, currentLevel = 1, globalBests = { runner:0, click:0, math:0 };

        onAuthStateChanged(auth, u => {
            if (u) {
                user = u;
                onSnapshot(doc(db, "usuarios", u.uid), snap => {
                    const d = snap.data(); if(!d) return;
                    currentXP = d.xp || 0;
                    currentLevel = Math.floor(Math.log2(currentXP/1000 + 1)) + 1;
                    if(currentXP < 1000) currentLevel = 1;

                    let targetXP = Math.pow(2, currentLevel - 1) * 1000;
                    let prevTotal = currentLevel === 1 ? 0 : (Math.pow(2, currentLevel-1)-1)*1000;
                    
                    document.getElementById('u-nome').innerText = (d.nome || "PLAYER").toUpperCase();
                    document.getElementById('u-lvl').innerText = currentLevel;
                    document.getElementById('xp-target').innerText = targetXP;
                    document.getElementById('xp-num').innerText = Math.floor(currentXP - prevTotal);
                    document.getElementById('xp-bar').style.width = ((currentXP - prevTotal) / targetXP * 100) + "%";
                    
                    globalBests = { runner: d.bestRunner||0, click: d.bestClick||0, math: d.bestMath||0 };
                    document.getElementById('best-runner').innerText = globalBests.runner;
                    document.getElementById('best-click').innerText = globalBests.click;
                    document.getElementById('best-math').innerText = globalBests.math;
                    updateCheckInUI(d.lastCheckIn);
                });
            }
        });

        async function addXP(v) { await updateDoc(doc(db, "usuarios", user.uid), { xp: increment(v) }); }
        async function saveBest(f, v) {
            if(v > globalBests[f]) {
                const up = {}; up[`best${f.charAt(0).toUpperCase() + f.slice(1)}`] = v;
                await updateDoc(doc(db, "usuarios", user.uid), up);
            }
        }

        // --- CHECK-IN ---
        window.processCheckIn = () => {
            document.getElementById('ad-overlay').style.display='flex';
            let t = 30;
            let i = setInterval(() => {
                t--; document.getElementById('ad-timer').innerText = t;
                if(t <= 0) { clearInterval(i); finishCheckIn(); }
            }, 1000);
        };
        async function finishCheckIn() {
            await updateDoc(doc(db, "usuarios", user.uid), { lastCheckIn: new Date().toLocaleDateString(), saldo: increment(0.02) });
            document.getElementById('ad-overlay').style.display='none';
        }
        function updateCheckInUI(ld) {
            const today = new Date().toLocaleDateString();
            const day = new Date().getDay();
            document.querySelectorAll('.day-dot').forEach(d => {
                if(parseInt(d.dataset.day) === day) d.classList.add('active');
                if(ld === today && parseInt(d.dataset.day) === day) {
                    d.classList.add('done');
                    const b = document.getElementById('btn-do-checkin');
                    b.innerText = "HOJE CONCLUÍDO"; b.disabled = true; b.style.opacity = "0.5";
                }
            });
        }

        // --- RUNNER ENGINE ---
        let rActive = false, rStart = 0, isJumping = false, blocks = 0;
        window.startRunner = () => {
            document.getElementById('runner-start-ui').style.display = 'none';
            rActive = true; rStart = Date.now(); blocks = 0;
            spawnObs();
        };
        window.jump = () => {
            if(!rActive || isJumping) return;
            isJumping = true; const h = document.getElementById('cube-hero');
            h.style.transition = "bottom 0.35s ease-out"; h.style.bottom = "90px";
            setTimeout(() => { h.style.bottom = "20px"; setTimeout(() => isJumping = false, 350); }, 350);
        };
        function spawnObs() {
            if(!rActive) return;
            const obs = document.createElement('div');
            obs.className = 'obstacle'; obs.style.right = "-30px";
            document.getElementById('runner-screen').appendChild(obs);
            let move = setInterval(() => {
                let x = parseInt(obs.style.right) + 7; obs.style.right = x + "px";
                let hBot = parseInt(document.getElementById('cube-hero').style.bottom);
                if(x > 265 && x < 288 && hBot < 48) {
                    clearInterval(move); obs.remove(); rActive = false;
                    saveBest('runner', Math.floor((Date.now() - rStart)/1000));
                    document.getElementById('runner-start-ui').style.display = 'flex';
                }
                if(x > 380) { clearInterval(move); obs.remove(); blocks++; if(blocks%2===0) addXP(1); spawnObs(); }
            }, 20);
        }
        document.getElementById('runner-screen').addEventListener('click', jump);

        // --- CLICKER ---
        let clicks = 0, cStart = null;
        window.doClickGame = () => {
            if(!cStart) cStart = Date.now();
            clicks++;
            document.getElementById('click-fill-bar').style.width = (clicks/20*100) + "%";
            if(clicks >= 20) {
                addXP(1); saveBest('click', Math.floor((Date.now() - cStart)/1000));
                clicks = 0; cStart = null;
                setTimeout(() => document.getElementById('click-fill-bar').style.width = "0%", 200);
            }
        };

        // --- MATH ---
        let n1, n2, res, mScore = 0;
        function nextM() { n1=Math.floor(Math.random()*15); n2=Math.floor(Math.random()*15); res=n1+n2; document.getElementById('math-quest').innerText = n1+"+"+n2; }
        nextM();
        window.checkMath = el => { if(parseInt(el.value) === res) { mScore++; addXP(1); saveBest('math', mScore); el.value = ""; nextM(); } };
    </script>
</body>
</html>
