<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minigames $$$ - v5.0</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        .ads-frame { width: 100%; height: 60px; border: 1px dashed #333; display: flex; align-items: center; justify-content: center; color: #444; font-size: 0.7rem; background: #0a0a0a; border-radius: 8px; margin: 10px 0; font-family: 'Orbitron'; }
        #game-canvas { width: 100%; height: 140px; background: #000; border: 2px solid var(--neon); border-radius: 10px; position: relative; overflow: hidden; display: none; }
        .grid-bg { position: absolute; width: 100%; height: 100%; background-image: linear-gradient(rgba(0,242,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,242,255,0.05) 1px, transparent 1px); background-size: 20px 20px; }
        #cube { position: absolute; bottom: 0; left: 40px; width: 20px; height: 20px; background: #00f2ff; box-shadow: 0 0 15px #00f2ff; transition: bottom 0.3s; }
        .obstacle { position: absolute; bottom: 0; right: -25px; width: 15px; height: 35px; background: #ff0055; box-shadow: 0 0 10px #ff0055; }
        .xp-bar-bg { background: #000; height: 12px; border-radius: 10px; border: 1px solid var(--neon); overflow: hidden; position: relative; }
        .xp-bar-fill { background: linear-gradient(90deg, var(--neon), #00ff88); height: 100%; width: 0%; transition: 0.5s; }
        button:disabled { opacity: 0.3; filter: grayscale(1); pointer-events: none; }
    </style>
</head>
<body>
    <div class="header">‚öôÔ∏è MINIGAMES $$$</div>
    <div class="container">
        <div class="ads-frame">SUA PROPAGANDA AQUI (TOPO)</div>
        <button onclick="window.location.href='index.html'" class="btn-small">‚¨Ö VOLTAR</button>

        <div class="card">
            <h2 style="font-family: 'Orbitron'; font-size: 1rem;">N√çVEL <span id="lvl-display">1</span></h2>
            <div style="position:relative; margin-top:15px;">
                <span style="position:absolute; right:0; top:-18px; color:var(--green); font-size:0.7rem; font-weight:bold;">+ R$ 0,10</span>
                <div class="xp-bar-bg"><div id="xp-bar" class="xp-bar-fill"></div></div>
            </div>
            <p id="xp-status" style="font-size: 0.6rem; color: #666; margin-top: 5px; text-align: center;">0.0000/100 XP</p>
        </div>

        <div class="card">
            <h4>üèÉ TRON RUNNER (+0.0001 XP)</h4>
            <div id="game-canvas"><div class="grid-bg"></div><div id="cube"></div></div>
            <button id="btn-game" onclick="startGame()" class="btn-primary">JOGAR</button>
        </div>

        <div class="card">
            <h4>üé∞ RASPADINHA (+0.05 XP)</h4>
            <div id="scratch-box" style="height:50px; background:#111; border:1px solid #333; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="playScratch()">RASPAR DI√ÅRIO</div>
        </div>

        <div class="card">
            <h4>üì± MISS√ïES (+0.25 XP)</h4>
            <button id="ad-ins" onclick="visitAd('https://instagram.com/sua', 'lastIns')" class="btn-outline" style="width:100%; margin-bottom:5px;">INSTAGRAM</button>
            <button id="ad-tik" onclick="visitAd('https://tiktok.com/@sua', 'lastTik')" class="btn-outline" style="width:100%;">TIKTOK</button>
        </div>
        <div class="ads-frame">SUA PROPAGANDA AQUI (RODAP√â)</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = { /* Copie do app.js */ };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let user, userData, gameRunning = false;

        onAuthStateChanged(auth, (u) => {
            if (u) {
                user = u;
                onSnapshot(doc(db, "usuarios", u.uid), (snap) => {
                    userData = snap.data();
                    if(userData) render();
                });
            } else { location.href='index.html'; }
        });

        function render() {
            const xp = userData.xp || 0;
            document.getElementById('lvl-display').innerText = Math.floor(xp / 100) + 1;
            document.getElementById('xp-bar').style.width = (xp % 100) + "%";
            document.getElementById('xp-status').innerText = `${(xp % 100).toFixed(4)}/100 XP`;
            const hoje = new Date().toISOString().split('T')[0];
            if(userData.lastScratch === hoje) document.getElementById('scratch-box').innerText = "‚úÖ CONCLU√çDO";
            if(userData.lastIns === hoje) document.getElementById('ad-ins').disabled = true;
            if(userData.lastTik === hoje) document.getElementById('ad-tik').disabled = true;
        }

        async function addXP(qtd) {
            const xp = userData.xp || 0;
            const up = Math.floor((xp + qtd) / 100) > Math.floor(xp / 100);
            let d = { xp: increment(qtd) };
            if(up) { d.saldo = increment(0.10); alert("N√çVEL UP! +R$ 0.10"); }
            await updateDoc(doc(db, "usuarios", user.uid), d);
        }

        window.startGame = () => {
            const canvas = document.getElementById('game-canvas');
            const cube = document.getElementById('cube');
            canvas.style.display = 'block'; document.getElementById('btn-game').style.display = 'none';
            gameRunning = true; let score = 0;
            canvas.onclick = () => { if(!cube.style.bottom || cube.style.bottom === '0px') { cube.style.bottom = '70px'; setTimeout(()=>cube.style.bottom='0px', 350); } };
            const spawn = setInterval(() => {
                if(!gameRunning) return clearInterval(spawn);
                const obs = document.createElement('div'); obs.className = 'obstacle'; obs.style.right = '-25px'; canvas.appendChild(obs);
                let pos = -25;
                const move = setInterval(() => {
                    if(!gameRunning) { obs.remove(); return clearInterval(move); }
                    pos += 5; obs.style.right = pos + 'px';
                    if(pos > 280 && pos < 315 && (!cube.style.bottom || cube.style.bottom === '0px')) { gameRunning = false; alert("GAME OVER"); location.reload(); }
                    if(pos > 380) { obs.remove(); score++; addXP(0.0001); clearInterval(move); }
                }, 20);
            }, 1600);
        };

        window.playScratch = async () => {
            const hoje = new Date().toISOString().split('T')[0];
            if(userData.lastScratch === hoje) return;
            await updateDoc(doc(db, "usuarios", user.uid), { lastScratch: hoje });
            await addXP(0.05); alert("Raspadinha: +0.05 XP");
        };

        window.visitAd = async (url, f) => {
            window.open(url, '_blank');
            let u = {}; u[f] = new Date().toISOString().split('T')[0]; u.xp = increment(0.25);
            await updateDoc(doc(db, "usuarios", user.uid), u);
        };
    </script>
</body>
</html>
