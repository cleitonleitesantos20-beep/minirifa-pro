<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minigames $$$ - RoboSorteio</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* 3. Anima√ß√£o da Raspadinha */
        .scratch-area { 
            position: relative; overflow: hidden; background: #333; 
            transition: all 0.5s ease;
        }
        .scratch-active { animation: shake 0.5s infinite; background: var(--neon) !important; color: #000 !important; }
        @keyframes shake {
            0% { transform: rotate(0deg); } 25% { transform: rotate(2deg); }
            50% { transform: rotate(0deg); } 75% { transform: rotate(-2deg); }
            100% { transform: rotate(0deg); }
        }

        /* 4. Anima√ß√£o de Minera√ß√£o (Pixels Verdes) */
        .mining-canvas { 
            width: 100%; height: 100px; background: #000; border-radius: 8px; 
            display: none; position: relative; overflow: hidden;
        }
        .pixel {
            position: absolute; width: 8px; height: 8px; background: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .btn-ad:disabled { opacity: 0.5; filter: grayscale(1); pointer-events: none; }
    </style>
</head>
<body>

    <div class="header">‚öôÔ∏è MINIGAMES $$$</div>

    <div class="container">
        <button onclick="window.location.href='index.html'" class="btn-small">‚¨Ö VOLTAR</button>

        <div class="card">
            <h2 style="font-family: 'Orbitron';">N√çVEL <span id="lvl-display">1</span></h2>
            <div style="background:#111; height:10px; border-radius:10px; margin:10px 0;">
                <div id="xp-bar" style="background:var(--neon); height:100%; width:0%; transition:1s;"></div>
            </div>
        </div>

        <div class="card">
            <h4>üé∞ RASPADEIRA $$$</h4>
            <div id="scratch-box" class="scratch-area" onclick="playScratch()" style="height:80px; display:flex; align-items:center; justify-content:center; border-radius:10px; border:2px dashed #555;">
                RASPAR AGORA
            </div>
        </div>

        <div class="card">
            <h4>‚õèÔ∏è MINERA√á√ÉO PIXEL</h4>
            <div id="mining-status" class="mining-canvas"></div>
            <button id="btn-mine" onclick="startMining()" class="btn-primary">MINERAR (R$ 0.03)</button>
        </div>

        <div class="card">
            <h4>üíé LOJAS PARCEIRAS (1X AO DIA)</h4>
            <button id="ad-1" onclick="visitAd('https://shopee.com.br', 'ad-1')" class="btn-ad" style="width:100%; margin-bottom:10px; padding:15px; background:#1a1a1a; color:#fff; border:1px solid #333; border-radius:8px;">üõí ACESSAR SHOPEE (+5 XP)</button>
            <button id="ad-2" onclick="visitAd('https://www.mercadolivre.com.br', 'ad-2')" class="btn-ad" style="width:100%; padding:15px; background:#1a1a1a; color:#fff; border:1px solid #333; border-radius:8px;">üì¶ MERCADO LIVRE (+5 XP)</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = { /* Seu Config Aqui */ };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let user, userData;

        onAuthStateChanged(auth, (u) => {
            if (u) {
                user = u;
                onSnapshot(doc(db, "usuarios", u.uid), (snap) => {
                    userData = snap.data();
                    atualizarInterface();
                });
            }
        });

        function atualizarInterface() {
            const xp = userData.xp || 0;
            const lvl = Math.floor(xp / 100) + 1;
            document.getElementById('lvl-display').innerText = lvl;
            document.getElementById('xp-bar').style.width = (xp % 100) + "%";

            const hoje = new Date().toISOString().split('T')[0];
            // Bloqueio patrocinadores
            if(userData.lastAd1 === hoje) document.getElementById('ad-1').disabled = true;
            if(userData.lastAd2 === hoje) document.getElementById('ad-2').disabled = true;
        }

        // 3. L√≥gica Raspadinha com Anima√ß√£o
        window.playScratch = async () => {
            const hoje = new Date().toISOString().split('T')[0];
            if(userData.lastScratch === hoje) return alert("Volte amanh√£!");

            const box = document.getElementById('scratch-box');
            box.classList.add('scratch-active');
            box.innerText = "RASPANDO...";

            setTimeout(async () => {
                box.classList.remove('scratch-active');
                box.innerText = "‚ú® GANHOU R$ 0.03";
                await updateDoc(doc(db, "usuarios", user.uid), {
                    saldo: increment(0.03),
                    xp: increment(2),
                    lastScratch: hoje
                });
            }, 2000);
        };

        // 4. L√≥gica Minera√ß√£o (Pixel Art)
        window.startMining = () => {
            const hoje = new Date().toISOString().split('T')[0];
            if(userData.lastMine === hoje) return alert("J√° minerou hoje!");

            const canvas = document.getElementById('mining-status');
            const btn = document.getElementById('btn-mine');
            btn.style.display = 'none';
            canvas.style.display = 'block';

            // Criar pixels quebrando
            for(let i=0; i<30; i++) {
                setTimeout(() => {
                    const p = document.createElement('div');
                    p.className = 'pixel';
                    p.style.left = Math.random() * 90 + "%";
                    p.style.top = Math.random() * 90 + "%";
                    canvas.appendChild(p);
                    // Anima√ß√£o de "quebra"
                    p.animate([
                        { transform: 'scale(1)', opacity: 1 },
                        { transform: 'scale(0) translateY(20px)', opacity: 0 }
                    ], 1000);
                }, i * 200);
            }

            setTimeout(async () => {
                await updateDoc(doc(db, "usuarios", user.uid), {
                    saldo: increment(0.03),
                    xp: increment(5),
                    lastMine: hoje
                });
                alert("Bloco minerado! +R$ 0.03");
                location.reload();
            }, 6000);
        };

        // 5. Patrocinadores com Limite
        window.visitAd = async (url, adId) => {
            const hoje = new Date().toISOString().split('T')[0];
            window.open(url, '_blank');
            
            let update = { xp: increment(5) };
            update[adId === 'ad-1' ? 'lastAd1' : 'lastAd2'] = hoje;
            
            await updateDoc(doc(db, "usuarios", user.uid), update);
            alert("Voc√™ ganhou 5 XP!");
        };
    </script>
</body>
</html>
