<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Configura√ß√µes - v5.1</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        .status-saque { font-size: 0.8rem; padding: 12px; border-radius: 8px; margin-top: 10px; text-align: center; font-weight: bold; }
        .bloqueado { background: rgba(255, 68, 68, 0.1); color: #ff4444; border: 1px solid #ff4444; }
        .liberado { background: rgba(0, 255, 136, 0.1); color: #00ff88; border: 1px solid #00ff88; }
        .link-box { background: #111; border: 1px solid #333; padding: 10px; border-radius: 5px; color: var(--neon); font-size: 0.8rem; width: 100%; text-align: center; margin-top: 10px; font-family: 'Rajdhani'; }
        .info-footer { font-size: 0.7rem; color: #444; text-align: center; margin-top: 30px; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="header">‚öôÔ∏è CONFIGURA√á√ïES</div>

    <div class="container">
        <button onclick="window.location.href='index.html'" class="btn-small" style="margin-bottom: 20px;">‚¨Ö VOLTAR</button>

        <div class="card">
            <h4>üîó LINK DE FILIAL</h4>
            <p style="font-size: 0.7rem; color: #888; margin-top: 5px;">Ganhe R$ 0,10 por cada amigo que se cadastrar pelo seu link:</p>
            <input type="text" id="link-filial" class="link-box" readonly value="Gerando link...">
            <button onclick="copiarLink()" class="btn-outline" style="width: 100%; margin-top: 10px;">COPIAR MEU LINK</button>
        </div>

        <div class="card">
            <h4>üí≥ SOLICITAR SAQUE</h4>
            <div id="saque-info">
                <p style="font-size: 0.9rem;">M√≠nimo para saque: <b>R$ 20,00</b></p>
                <div id="status-msg" class="status-saque bloqueado">
                    CARREGANDO DADOS...
                </div>
                <div id="pix-area" class="hidden" style="margin-top: 15px;">
                    <input type="text" id="chave-pix" placeholder="Sua Chave PIX (CPF, E-mail ou Celular)" style="margin-bottom: 10px;">
                    <button onclick="solicitarSaque()" class="btn-primary" style="width: 100%;">ENVIAR SOLICITA√á√ÉO</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h4>üêû FEEDBACK / SUPORTE</h4>
            <textarea id="feedback-text" placeholder="Sugest√µes, d√∫vidas ou relatar bugs..." style="width:100%; background:#000; color:#fff; border:1px solid #333; padding:10px; border-radius:5px; margin-top:10px; font-family:'Rajdhani'; height: 80px;"></textarea>
            <button onclick="enviarFeedback()" class="btn-outline" style="width: 100%; margin-top: 10px;">ENVIAR FEEDBACK</button>
        </div>

        <div class="card" style="border-color: #ff4444;">
            <button onclick="sairConta()" class="btn-primary" style="background: #ff4444; width: 100%;">SAIR DA CONTA</button>
        </div>

        <div class="info-footer">
            Idealizado por [Seu Projeto]<br>
            Desenvolvido e Codificado por uma Intelig√™ncia Artificial v5.1.
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYO5RWaJy5y7r7jvzFk3wq-ByqM_dWWO8",
            authDomain: "minharifadigital.firebaseapp.com",
            projectId: "minharifadigital",
            storageBucket: "minharifadigital.firebasestorage.app",
            messagingSenderId: "59630725905",
            appId: "1:59630725905:web:396c8cfca385dc3d957ab0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (u) => {
            if (u) {
                onSnapshot(doc(db, "usuarios", u.uid), (snap) => {
                    const data = snap.data();
                    if (!data) return;

                    // Gerar Link de Filial
                    const link = window.location.origin + "/index.html?ref=" + data.meuCodigo;
                    document.getElementById('link-filial').value = link;

                    // L√≥gica de Saque
                    const statusMsg = document.getElementById('status-msg');
                    const pixArea = document.getElementById('pix-area');
                    const saldo = data.saldo || 0;

                    if (saldo >= 20) {
                        statusMsg.innerText = "‚úÖ SAQUE DISPON√çVEL!";
                        statusMsg.className = "status-saque liberado";
                        pixArea.classList.remove('hidden');
                    } else {
                        statusMsg.innerHTML = `üîí BLOQUEADO<br><span style="font-size:0.7rem">FALTAM R$ ${(20 - saldo).toFixed(2)}</span>`;
                        statusMsg.className = "status-saque bloqueado";
                        pixArea.classList.add('hidden');
                    }
                });
            } else {
                window.location.href = 'index.html';
            }
        });

        window.copiarLink = () => {
            const copyText = document.getElementById("link-filial");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");
            alert("Link de filial copiado!");
        };

        window.solicitarSaque = () => {
            const chave = document.getElementById('chave-pix').value;
            if(!chave) return alert("Insira sua chave PIX!");
            alert("IA: Solicita√ß√£o enviada! Nossa equipe processar√° o pagamento em at√© 48 horas.");
        };

        window.enviarFeedback = async () => {
            const texto = document.getElementById('feedback-text').value;
            if(!texto) return alert("Escreva algo antes de enviar.");
            
            try {
                await setDoc(doc(db, "feedbacks", Date.now().toString()), {
                    uid: auth.currentUser.uid,
                    mensagem: texto,
                    data: new Date().toISOString()
                });
                alert("Feedback enviado com sucesso!");
                document.getElementById('feedback-text').value = "";
            } catch (e) { alert("Erro ao enviar: " + e.message); }
        };

        window.sairConta = () => {
            signOut(auth).then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                alert("Erro ao sair: " + error.message);
            });
        };
    </script>
</body>
</html>
