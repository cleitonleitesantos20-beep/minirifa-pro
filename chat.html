<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NexusVL - Deep Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon: #00f2ff;
            --pink: #ff0055;
            --bg: #020205;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: #fff; 
            font-family: 'Rajdhani'; 
            overflow: hidden; 
            height: 100vh; width: 100vw;
        }

        /* --- CIDADE 2D ATIVA --- */
        #city-container {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            overflow-x: scroll;
            overflow-y: hidden;
            z-index: 1;
            background: linear-gradient(to bottom, #050a15 0%, #020205 100%);
        }

        .city-svg { 
            width: 6000px; 
            height: 80%; /* Cidade menor na tela */
            margin-top: 10vh;
            display: block; 
        }

        .skyline { fill: #0a0a1a; stroke: rgba(0, 242, 255, 0.2); stroke-width: 1; }
        
        /* Luzes das Janelas Animadas */
        .light { fill: var(--neon); opacity: 0.3; transition: 0.5s; }
        .light.blink { animation: blinker 2s infinite; }
        @keyframes blinker { 50% { opacity: 0.8; filter: blur(2px); } }

        /* --- BOT√ïES VIRTUAIS --- */
        .v-button {
            position: fixed;
            width: 60px; height: 60px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid var(--neon);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            z-index: 100;
            cursor: pointer;
            pointer-events: all;
            transition: 0.3s;
        }

        .v-button:active { transform: scale(0.9); box-shadow: 0 0 25px var(--neon); }

        #btn-global { bottom: 30px; left: 30px; }
        #btn-friends { bottom: 30px; left: 110px; }
        #btn-toggle { top: 30px; right: 30px; font-size: 0.8rem; font-family: 'Orbitron'; color: var(--neon); border-radius: 10px; width: auto; padding: 0 15px; }

        /* --- CHAT SOBREPOSTO (FLUTUANTE) --- */
        #chat-window {
            position: fixed;
            bottom: 110px; left: 30px;
            width: 320px; height: 400px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 20px;
            z-index: 90;
            display: none; /* Come√ßa escondido */
            flex-direction: column;
            padding: 15px;
            pointer-events: all;
            border: 1px solid var(--neon);
        }

        .chat-messages { flex: 1; overflow-y: auto; margin-bottom: 10px; font-size: 0.9rem; }
        .chat-input-area { display: flex; gap: 5px; border-top: 1px solid rgba(0,242,255,0.2); padding-top: 10px; }
        input { background: transparent; border: none; color: #fff; outline: none; flex: 1; }

        @media (max-width: 600px) {
            #chat-window { width: calc(100vw - 60px); }
        }
    </style>
</head>
<body>

    <div class="v-button" id="btn-global" onclick="toggleChat('GLOBAL')">üåê</div>
    <div class="v-button" id="btn-friends" onclick="toggleChat('FRIENDS')">üë•</div>
    <div class="v-button" id="btn-toggle" onclick="toggleCityMode()">AGITAR CIDADE</div>

    <div id="chat-window">
        <div id="chat-title" style="font-family: 'Orbitron'; font-size: 0.7rem; color: var(--neon); margin-bottom: 10px;">GLOBAL_STREAM</div>
        <div class="chat-messages" id="chat-box">
            <div style="color: var(--neon)">[SISTEMA]: CONECTADO.</div>
        </div>
        <div class="chat-input-area">
            <input type="text" placeholder="Transmitir..." id="chat-input">
            <button onclick="sendMsg()" style="background:none; border:none; color:var(--neon); cursor:pointer;">></button>
        </div>
    </div>

    <div id="city-container">
        <svg id="city-svg" class="city-svg" viewBox="0 0 6000 1000">
            <g id="back-layer"></g>
            <g id="traffic-layer"></g>
            <g id="front-layer"></g>
        </svg>
    </div>

    <script type="module">
        let agilityLevel = 1;

        document.addEventListener('DOMContentLoaded', () => {
            build2DCity();
            startTraffic();
        });

        function build2DCity() {
            const back = document.getElementById('back-layer');
            const front = document.getElementById('front-layer');
            
            for(let i = 0; i < 100; i++) {
                const x = i * 60;
                const h = 200 + Math.random() * 400;
                const w = 80 + Math.random() * 100;
                
                // Silhueta do pr√©dio
                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("x", x);
                rect.setAttribute("y", 1000 - h);
                rect.setAttribute("width", w);
                rect.setAttribute("height", h);
                rect.setAttribute("class", "skyline");
                back.appendChild(rect);

                // Luzes ativas
                for(let j = 0; j < 5; j++) {
                    const light = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    light.setAttribute("cx", x + (Math.random() * w));
                    light.setAttribute("cy", (1000 - h) + (Math.random() * h));
                    light.setAttribute("r", "1.5");
                    light.setAttribute("class", "light blink");
                    light.style.animationDuration = (1 + Math.random() * 3) + "s";
                    front.appendChild(light);
                }
            }
        }

        function startTraffic() {
            const traffic = document.getElementById('traffic-layer');
            setInterval(() => {
                const car = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                const y = 850 + (Math.random() * 100);
                car.setAttribute("x", "-50");
                car.setAttribute("y", y);
                car.setAttribute("width", "40");
                car.setAttribute("height", "1");
                car.setAttribute("fill", Math.random() > 0.5 ? "var(--neon)" : "var(--pink)");
                
                // Velocidade baseada na agita√ß√£o
                const duration = (10 / agilityLevel);
                car.style.transition = `transform ${duration}s linear`;
                traffic.appendChild(car);
                
                setTimeout(() => car.style.transform = "translateX(6100px)", 50);
                setTimeout(() => car.remove(), duration * 1000);
            }, 1000 / agilityLevel);
        }

        window.toggleChat = (type) => {
            const win = document.getElementById('chat-window');
            const title = document.getElementById('chat-title');
            if(win.style.display === 'flex' && title.innerText.includes(type)) {
                win.style.display = 'none';
            } else {
                win.style.display = 'flex';
                title.innerText = type + "_STREAM";
            }
        };

        window.toggleCityMode = () => {
            agilityLevel = agilityLevel >= 5 ? 1 : agilityLevel + 2;
            const box = document.getElementById('chat-box');
            box.innerHTML += `<div style="color:var(--pink)">[ALERTA]: AGITA√á√ÉO N√çVEL ${agilityLevel}</div>`;
        };

        window.sendMsg = () => {
            const input = document.getElementById('chat-input');
            if(!input.value) return;
            document.getElementById('chat-box').innerHTML += `<div>> ${input.value}</div>`;
            input.value = "";
        };
    </script>
    <script type="module" src="nexus-overlay.js"></script>
</body>
</html>
